-- Insertion des combinaisons dans ProduitVersionSysteme
INSERT INTO ProduitVersionSysteme (produit_id, version_id, systeme_exploitation_id)
SELECT p.id, v.id, se.id
FROM Produit p, Version v, Systeme_exploitation se
WHERE ((p.nom = 'Trader en Herbe' AND v.nom = '1.0' AND se.nom IN ('Linux', 'Windows'))
    OR (p.nom = 'Trader en Herbe' AND v.nom = '1.1' AND se.nom IN ('Linux', 'MacOS', 'Windows'))
    OR (p.nom = 'Trader en Herbe' AND v.nom = '1.2' AND se.nom IN ('Linux', 'MacOS', 'Windows', 'Android', 'iOS', 'Windows Mobile'))
    OR (p.nom = 'Trader en Herbe' AND v.nom = '1.3' AND se.nom IN ('MacOS', 'Windows', 'Android', 'iOS'))
    OR (p.nom = 'Maître des Investissements' AND v.nom = '1.0' AND se.nom IN ('MacOS', 'iOS'))
    OR (p.nom = 'Maître des Investissements' AND v.nom = '2.0' AND se.nom IN ('MacOS', 'Android', 'iOS'))
    OR (p.nom = 'Maître des Investissements' AND v.nom = '2.1' AND se.nom IN ('MacOS', 'Windows', 'Android', 'iOS'))
    OR (p.nom = 'Planificateur d''Entraînement' AND v.nom = '1.0' AND se.nom IN ('Linux', 'MacOS'))
    OR (p.nom = 'Planificateur d''Entraînement' AND v.nom = '1.1' AND se.nom IN ('Linux', 'MacOS', 'Windows', 'Android', 'iOS', 'Windows Mobile'))
    OR (p.nom = 'Planificateur d''Entraînement' AND v.nom = '2.0' AND se.nom IN ('MacOS', 'Windows', 'Android', 'iOS'))
    OR (p.nom = 'Planificateur d''Anxiété Sociale' AND v.nom = '1.0' AND se.nom IN ('MacOS', 'Windows', 'Android', 'iOS'))
    OR (p.nom = 'Planificateur d''Anxiété Sociale' AND v.nom = '1.1' AND se.nom IN ('MacOS', 'Windows', 'Android', 'iOS')))
  AND NOT EXISTS (
    SELECT 1
    FROM ProduitVersionSysteme pvs
    WHERE pvs.produit_id = p.id 
      AND pvs.version_id = v.id 
      AND pvs.systeme_exploitation_id = se.id
);
